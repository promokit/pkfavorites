class Favorites{animationTime=700;constructor(){if("undefined"==typeof pkfavorites)return console.error("Promokit Favorites module is not installed properly. Try to reset it.");document.body.addEventListener("click",this.clickHandler.bind(this))}get classes(){return{sidebar:"js-tab-favorites",counter:"js-pkfavorites-counter",dropdown:"js-pkfavorites-container",iconActive:"icon_checked",inProgress:"in_progress",buttonType:"icon-button",mainParent:"product-miniature",button:"favoritesButton",hidden:"hidden"}}clickHandler(t){const e=t.target;if(!e.classList.contains(this.classes.button))return;t.preventDefault();const s=this.setContext(e.dataset.action);this.doAction(e,s)}setContext(t){const e={url:pkfavorites.add,message:pkfavorites.phrases.added,button:pkfavorites.phrases.remove,state:"success",action:t};return"remove"===t&&(e.url=pkfavorites.remove,e.message=pkfavorites.phrases.removed,e.button=pkfavorites.phrases.add,e.state="info"),e}async doAction(t,e){const s=Number(t.dataset.pid);if(!s)throw new Error("Wrong Product ID");this.loaderToggler(t,"on");const r=await this.makeRequest(e,s);await this.updateButton(t,e),this.updateProductCounter(t,r.overall_number),this.renderProducts(r),this.updateOverallCounter(r.products_number),this.displayMessage(e.message,e.state)}async makeRequest(t,e){try{const s=`${t.url}&id_product=${e}`,r=await fetch(s,{method:"POST"});if(!r.ok)throw new Error(`Error ${r.status}`);const o=await r.json();if(!o)throw new Error("Empty response");return o}catch(t){this.displayMessage(t,"error")}}loaderToggler(t,e){const s=t.querySelector("span")?t.querySelector("svg"):t;"on"===e&&s.classList.add(this.classes.inProgress),"off"===e&&s.classList.remove(this.classes.inProgress)}updateButton(t,e){t.dataset.action="add"===e.action?"remove":"add",t.classList.toggle(this.classes.iconActive),t.setAttribute("title",e.button);const s=t.querySelector("span");s&&(s.textContent=e.button),this.loaderToggler(t,"off");const r=t.closest(`.${this.classes.sidebar}`);return"remove"===e.action&&r&&this.hideProduct(t),this.wait()}hideProduct(t){t.closest(`.${this.classes.mainParent}`).style.transition=`all ${this.animationTime}ms ease-in-out`,t.closest(`.${this.classes.mainParent}`).style.opacity=0}renderProducts(t){const e=document.querySelector(`.${this.classes.dropdown}`),s=document.querySelector(`.${this.classes.sidebar}`);s&&(s.innerHTML=t.products),e&&(e.parentElement.style.height="auto",e.innerHTML=t.miniproducts,t.products_number>0&&e.parentElement.classList.remove(this.classes.hidden),t.products_number<=0&&e.parentElement.classList.add(this.classes.hidden))}updateOverallCounter(t){const e=document.querySelector(`.${this.classes.counter}`);e&&(e.textContent=t,t>0&&e.classList.remove(this.classes.hidden))}updateProductCounter(t,e){const s=t.querySelector("i");s&&e&&(s.textContent=e)}displayMessage(t,e){$.jGrowl(t,{theme:`${$.jGrowl.defaults.theme} ${e}`,header:pkfavorites.phrases.title}),"error"===e&&console.error(t)}wait(){return new Promise((t=>setTimeout(t,this.animationTime)))}}new Favorites;